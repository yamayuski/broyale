# Broyale - Browser Online Multiplayer Battle-royale Game

このリポジトリは、ブラウザベースのオンラインマルチプレイヤー バトルロイヤル
ゲーム「Broyale」のソースコードを含んでいます。プレイヤーは仮想アリーナで戦い、最後の一人になるまで戦い続けます。

## 基本構成

- ソースコードはほぼ Deno による TypeScript で書かれます
- フロントエンドは Vite で開発を行います
  - 3D レンダリングエンジンは Babylon.js を使用します
- バックエンドは Deno の HTTPS サーバを使用します
- WebTransport(deno, unstable) を用いて通信を行います(WebSocket
  へのフォールバックも検討するが最初は WebTransport のみ想定)
  - そのため、フォールバックを想定した実装にします
  - ネットワークトランスポートは抽象化を適切に行い、クライアントやサーバのロジック実装時は意識する必要がないようにします
- 個人開発のため、マルチプレイのテストが困難なので、ローカルで開発する際は BOT
  として適当に動く AI のプロセスを用意して参加させます
- ゲームロジック設計は Entity Component System(ECS) を用います
  - ECS フレームワークは自作します
  - ECS
    フレームワークは、ネットワークレプリケーションを念頭に置いた設計を行います
  - ECS フレームワークは、ランタイムを問わず pure TypeScript
    で動作するようにします
- サーバ・クライアント間の通信は、基本的にサーバが正（authoritative）とし、クライアントは入力を送信し、補完（prediction）・補正（reconciliation）を行います
- ネットワーク通信は、帯域制約と遅延を考慮し、必要な情報のみを効率的に送受信するようにします（差分、興味管理、優先度）
- ECS
  の設計をネットワーク要件に合わせて調整します：どのコンポーネントを複製するか、誰が所有するかを明確化します
- any は極力避け、 unknown を代用すること
- readonly, ReadonlyArray, as const などを積極的に用いて不変性を保つこと
- as による型変換は極力避けること

## ディレクトリ構成

- `certs/` - HTTPS サーバ用の自己署名証明書(mkcert で生成)
- `client/` - Vite によるフロントエンドのソースコード
- `docs/` - 各種ドキュメント
- `ecs/` - 自作 ECS フレームワークのソースコード
- `server/` - Deno によるバックエンドのソースコード

## 最終生成物

- クライアント静的ファイル群（`client/dist/`）
  - Cloudflare などでホスティングすることを想定しています
- サーババイナリ（Deno スクリプト）
